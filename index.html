<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mini 3D Engine</title>
<style>
body { margin:0; display:flex; height:100vh; font-family:sans-serif; }
#editor { width:40%; padding:10px; background:#222; color:white; }
textarea { width:100%; height:80%; background:#111; color:#0f0; font-family:monospace; }
button { width:100%; padding:10px; margin-top:5px; cursor:pointer; }
#game { width:60%; position:relative; }
</style>
</head>
<body>

<div id="editor">
<h3>Код сцены</h3>
<textarea id="code">
// Пример: добавление кубов
for(let x=-3;x<=3;x++)
  for(let z=-3;z<=3;z++)
    createCube(x,0.5,z,0xff0000);
</textarea>
<button onclick="runUserCode()">▶ Запустить код</button>
<button onclick="clearCode()">❌ Очистить</button>
</div>

<div id="game"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
let scene, camera, renderer, animateId;

// ===================== ИНИЦИАЛИЗАЦИЯ ДВИЖКА =====================
function initEngine(){
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87ceeb);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth*0.6/window.innerHeight, 0.1, 1000);
    camera.position.set(5,5,5);
    camera.lookAt(0,0,0);

    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth*0.6, window.innerHeight);
    document.getElementById("game").appendChild(renderer.domElement);

    // Сетка и свет
    scene.add(new THREE.GridHelper(20,20));
    const light = new THREE.DirectionalLight(0xffffff,1);
    light.position.set(5,10,7);
    scene.add(light);

    // Автоматически создаём зелёную землю
    for(let x=-5;x<=5;x++)
      for(let z=-5;z<=5;z++)
        createCube(x,0,z,0x00ff00);

    animate();
}

// ===================== СОЗДАНИЕ КУБА =====================
function createCube(x,y,z,color){
    const g = new THREE.BoxGeometry();
    const m = new THREE.MeshStandardMaterial({color});
    const c = new THREE.Mesh(g,m);
    c.position.set(x,y,z);
    scene.add(c);
}

// ===================== АНИМАЦИЯ =====================
function animate(){
    animateId = requestAnimationFrame(animate);
    renderer.render(scene,camera);
}

// ===================== ПОЛЬЗОВАТЕЛЬСКИЙ КОД =====================
function runUserCode(){
    try{
        const code = document.getElementById("code").value;
        const func = new Function('createCube', code);
        func(createCube);
    } catch(e){
        alert("Ошибка в коде: " + e);
    }
}

// ===================== ОЧИСТИТЬ КОД =====================
function clearCode(){
    document.getElementById("code").value="";
}

// ===================== ЗАПУСК ДВИЖКА =====================
window.addEventListener('load', initEngine);
</script>

</body>
</html>
